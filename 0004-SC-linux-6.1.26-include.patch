diff -rup linux-6.1.26.orig/include/linux/pgtable.h linux-6.1.26/include/linux/pgtable.h
--- linux-6.1.26.orig/include/linux/pgtable.h	2023-04-26 22:28:44.000000000 +1000
+++ linux-6.1.26/include/linux/pgtable.h	2023-05-03 13:12:07.434052732 +1000
@@ -59,11 +59,13 @@
  * because in such cases PTRS_PER_PxD equals 1.
  */
 
+#ifndef pte_index
 static inline unsigned long pte_index(unsigned long address)
 {
 	return (address >> PAGE_SHIFT) & (PTRS_PER_PTE - 1);
 }
 #define pte_index pte_index
+#endif
 
 #ifndef pmd_index
 static inline unsigned long pmd_index(unsigned long address)
@@ -94,6 +96,7 @@ static inline pte_t *pte_offset_kernel(p
 #define pte_offset_kernel pte_offset_kernel
 #endif
 
+#ifndef pte_offset_map
 #if defined(CONFIG_HIGHPTE)
 #define pte_offset_map(dir, address)				\
 	((pte_t *)kmap_atomic(pmd_page(*(dir))) +		\
@@ -102,6 +105,7 @@ static inline pte_t *pte_offset_kernel(p
 #else
 #define pte_offset_map(dir, address)	pte_offset_kernel((dir), (address))
 #define pte_unmap(pte) ((void)(pte))	/* NOP */
+#endif /* CONFIG_HIGH_PTE */
 #endif
 
 /* Find an entry in the second-level page table.. */
